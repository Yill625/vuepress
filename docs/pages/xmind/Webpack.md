# WebPack

## åŸºç¡€

### entry :sring | []

> å…¥å£èµ·ç‚¹ï¼ŒæŒ‡ç¤º Webpack åº”è¯¥ä»å“ªä¸ªæ¨¡å—å¼€å§‹ï¼Œæ¥ä½œä¸ºæ„å»ºå†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼ŒWebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“çš„å…¥å£èµ·ç‚¹ç›´æ¥æˆ–é—´æ¥ä¾èµ–çš„ï¼Œæ¯ä¸ªä¾èµ–æƒ³éšå³è¢«å¤„ç†ï¼Œæœ€åè¾“å‡ºåˆ°ç§°ä¹‹ä¸º bundles çš„æ–‡ä»¶ä¸­

å•å…¥å£ : string
å¤šå…¥å£ : [] éœ€è¦å¤šä¸ªç‹¬ç«‹åˆ†ç¦»çš„ä¾èµ–

### output

> æ¦‚å¿µ: output å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundlesï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸º ./distã€‚åŸºæœ¬ä¸Šï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºç»“æ„ï¼Œéƒ½ä¼šè¢«ç¼–è¯‘åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºè·¯å¾„çš„æ–‡ä»¶å¤¹ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®šä¸€ä¸ª output å­—æ®µï¼Œæ¥é…ç½®è¿™äº›å¤„ç†è¿‡ç¨‹

- filename: æ–‡ä»¶å
- chunkFilename
- path: path ç›®æ ‡è¾“å‡ºç›®å½•çš„ç»å¯¹è·¯å¾„
- publicPathï¼š
  - webpack æä¾›ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é…ç½®ï¼Œè¯¥é…ç½®èƒ½å¸®åŠ©ä½ ä¸ºé¡¹ç›®ä¸­çš„æ‰€æœ‰èµ„æºæŒ‡å®šä¸€ä¸ªåŸºç¡€è·¯å¾„ï¼Œå®ƒè¢«ç§°ä¸ºå…¬å…±è·¯å¾„(publicPath)ã€‚
  - é™æ€èµ„æºæœ€ç»ˆè®¿é—®è·¯å¾„ = output.publicPath + èµ„æº loader æˆ–æ’ä»¶ç­‰é…ç½®è·¯å¾„ ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼špublicPath: "https://cdn.example.com/assets/"
    å‰ç«¯æ‰“åŒ…çš„å‡ºæ¥çš„æ–‡ä»¶ ğŸ“ƒ å®é™…å°±æ˜¯é™æ€èµ„æº
- library: library æŒ‡å®šçš„å°±æ˜¯ä½ æ˜¯ç”¨ require æ—¶çš„æ¨¡å—å
- librayTarget: é…ç½®å¦‚ä½•æš´éœ² library çš„æ–¹å¼

### loaders

> æˆ‘ä»¬åœ¨å‰ç«¯æ„å»ºä¸­ä¼šé‡è§éœ€è¦ä½¿ç”¨å„å¼å„æ ·çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ css ä»£ç ï¼Œå›¾ç‰‡ï¼Œæ¨¡æ¿ä»£ç ç­‰ã€‚webpack ä¸­æä¾›ä¸€ç§å¤„ç†å¤šç§æ–‡ä»¶æ ¼å¼çš„æœºåˆ¶ï¼Œä¾¿æ˜¯ä½¿ç”¨ loaderã€‚æˆ‘ä»¬å¯ä»¥æŠŠ loader ç†è§£ä¸ºæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œè´Ÿè´£æŠŠæŸç§æ–‡ä»¶æ ¼å¼çš„å†…å®¹è½¬æ¢æˆ webpack å¯ä»¥æ”¯æŒæ‰“åŒ…çš„æ¨¡å—ã€‚ï¼ˆæ³¨æ„å§‹ç»ˆç†è§£ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ babel æ˜¯å¤„ç†æ¨¡å— module çš„,ä½ å¼•å…¥äº†ä¸€ä¸ªæ¨¡å—èµ„æºå°±è¦ç”¨å¯¹åº”çš„ loader å»å¤„ç†ï¼‰

> ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼šä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æ²¡æœ‰æ·»åŠ é¢å¤–æ’ä»¶çš„æƒ…å†µä¸‹ï¼Œwebpack ä¼šé»˜è®¤æŠŠæ‰€æœ‰ä¾èµ–æ‰“åŒ…æˆ js æ–‡ä»¶ï¼Œå¦‚æœå…¥å£æ–‡ä»¶ä¾èµ–ä¸€ä¸ª .hbs çš„æ¨¡æ¿æ–‡ä»¶ä»¥åŠä¸€ä¸ª .css çš„æ ·å¼æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ handlebars-loader æ¥å¤„ç† .hbs æ–‡ä»¶ï¼Œéœ€è¦ css-loader æ¥å¤„ç† .css æ–‡ä»¶ï¼ˆè¿™é‡Œå…¶å®è¿˜éœ€è¦ style-loaderï¼Œåç»­è¯¦è§£ï¼‰ï¼Œæœ€ç»ˆæŠŠä¸åŒæ ¼å¼çš„æ–‡ä»¶éƒ½è§£ææˆ js ä»£ç ï¼Œä»¥ä¾¿æ‰“åŒ…ååœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚

#### å¸¸ç”¨çš„ loader

- css-loader
- less-loader
- scss-loader
- file-loader
- babel-loader
- ts-loader
- eslint-loader
- thread-loader

### plugins

> loader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼ˆä¸æ¨¡å—æŒ‚é’©ï¼‰ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼Œä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚

#### å¸¸ç”¨çš„ plugin

- HotModuleReplacementPlugin
  æ¨¡å—çƒ­æ›´æ–°æ’ä»¶ã€‚Hot-Module-Replacement çš„çƒ­æ›´æ–°æ˜¯ä¾èµ–äº webpack-dev-serverï¼Œåè€…æ˜¯åœ¨æ‰“åŒ…æ–‡ä»¶æ”¹å˜æ—¶æ›´æ–°æ‰“åŒ…æ–‡ä»¶æˆ–è€… reload åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼ŒHRM æ˜¯åªæ›´æ–°ä¿®æ”¹çš„éƒ¨åˆ†
- HtmlWebpackPlugin
  ç”Ÿæˆ html æ–‡ä»¶ã€‚å°† webpack ä¸­ entry é…ç½®çš„ç›¸å…³å…¥å£ chunk å’Œ extract-text-webpack-plugin æŠ½å–çš„ css æ ·å¼ æ’å…¥åˆ°è¯¥æ’ä»¶æä¾›çš„ template æˆ–è€… templateContent é…ç½®é¡¹æŒ‡å®šçš„å†…å®¹åŸºç¡€ä¸Šç”Ÿæˆä¸€ä¸ª html æ–‡ä»¶ï¼Œå…·ä½“æ’å…¥æ–¹å¼æ˜¯å°†æ ·å¼ link æ’å…¥åˆ° head å…ƒç´ ä¸­ï¼Œscript æ’å…¥åˆ° head æˆ–è€… body ä¸­ã€‚
- clean-webpack-plugin
  clean-webpack-plugin ç”¨äºåœ¨æ‰“åŒ…å‰æ¸…ç†ä¸Šä¸€æ¬¡é¡¹ç›®ç”Ÿæˆçš„ bundle æ–‡ä»¶ï¼Œå®ƒä¼šæ ¹æ® output.path è‡ªåŠ¨æ¸…ç†æ–‡ä»¶å¤¹ï¼›è¿™ä¸ªæ’ä»¶åœ¨ç”Ÿäº§ç¯å¢ƒç”¨çš„é¢‘ç‡éå¸¸é«˜ï¼Œå› ä¸ºç”Ÿäº§ç¯å¢ƒç»å¸¸ä¼šé€šè¿‡ hash ç”Ÿæˆå¾ˆå¤š bundle æ–‡ä»¶ï¼Œå¦‚æœä¸è¿›è¡Œæ¸…ç†çš„è¯æ¯æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„ï¼Œå¯¼è‡´æ–‡ä»¶å¤¹éå¸¸åºå¤§ã€‚
- mini-css-extract-plugin
  - å°† CSS æå–ä¸ºç‹¬ç«‹çš„æ–‡ä»¶çš„æ’ä»¶ï¼Œå¯¹æ¯ä¸ªåŒ…å« css çš„ js æ–‡ä»¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ª CSS æ–‡ä»¶ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½ css å’Œ sourceMap
  - è¿™ä¸ªæ’ä»¶åº”è¯¥åªç”¨åœ¨ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œå¹¶ä¸”åœ¨ loaders é“¾ä¸­ä¸ä½¿ç”¨ style-loader, è€Œä¸”è¿™ä¸ªæ’ä»¶æš‚æ—¶ä¸æ”¯æŒ HMR
- purifycss-webpack
  - æœ‰æ—¶å€™æˆ‘ä»¬ css å†™å¾—å¤šäº†æˆ–è€…é‡å¤äº†ï¼Œè¿™å°±é€ æˆäº†å¤šä½™çš„ä»£ç ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒè¿›è¡Œå»é™¤ã€‚
- optimize-css-assets-webpack-plugin
  - æˆ‘ä»¬å¸Œæœ›å‡å° css æ‰“åŒ…åçš„ä½“ç§¯ï¼ˆè¿›è¡Œå‹ç¼©ï¼‰ï¼Œå¯ä»¥ç”¨åˆ° optimize-css-assets-webpack-pluginã€‚

### devltool

> æŒ‡å®šä»£ç çš„ source map ç”Ÿæˆæ–¹å¼

## æ¨¡å—

### module

å¯¹äºä¸€ä»½åŒé€»è¾‘çš„ä»£ç ï¼Œå½“æˆ‘ä»¬æ‰‹å†™ä¸‹ä¸€ä¸ªä¸€ä¸ªçš„æ–‡ä»¶ï¼Œå®ƒä»¬æ— è®ºæ˜¯ ESM è¿˜æ˜¯ commonJS æˆ–æ˜¯ AMDï¼Œä»–ä»¬éƒ½æ˜¯ module

### chunk

ä¸€èˆ¬æ¥è¯´ä¸€ä¸ª chunk å¯¹åº”ä¸€ä¸ª bundleï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­çš„ utils.js -> chunks 1 -> utils.bundle.jsï¼›ä½†ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚è¯´ä¸Šå›¾ä¸­ï¼Œæˆ‘å°±ç”¨ MiniCssExtractPlugin ä» chunks 0 ä¸­æŠ½ç¦»å‡ºäº† index.bundle.css æ–‡ä»¶ã€‚

### bundle

webpack å¤„ç†å¥½ chunk æ–‡ä»¶åï¼Œæœ€åä¼šè¾“å‡º bundle æ–‡ä»¶ï¼Œè¿™ä¸ª bundle æ–‡ä»¶åŒ…å«äº†ç»è¿‡åŠ è½½å’Œç¼–è¯‘çš„æœ€ç»ˆæºæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚

::: tip
moduleï¼Œchunk å’Œ bundle å…¶å®å°±æ˜¯åŒä¸€ä»½é€»è¾‘ä»£ç åœ¨ä¸åŒè½¬æ¢åœºæ™¯ä¸‹çš„å–äº†ä¸‰ä¸ªåå­—
æˆ‘ä»¬ç›´æ¥å†™å‡ºæ¥çš„æ˜¯ moduleï¼Œwebpack å¤„ç†æ—¶æ˜¯ chunkï¼Œæœ€åç”Ÿæˆæµè§ˆå™¨å¯ä»¥ç›´æ¥è¿è¡Œçš„ bundle
:::

## æ–‡ä»¶æŒ‡çº¹ç­–ç•¥

> æ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶ååç¼€ï¼Œç”¨äºç‰ˆæœ¬ç®¡ç†

### æ–‡ä»¶æŒ‡çº¹ç±»å‹

1. hash: å’Œæ•´ä¸ªé¡¹ç›®çš„æ„å»ºç›¸å…³ï¼Œåªè¦é¡¹ç›®æ–‡ä»¶æœ‰ä¿®æ”¹ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ„å»º hash å€¼å°±ä¼šæ”¹å˜
2. chunkhash: å’Œ Webpack æ‰“åŒ…çš„ chunk æœ‰å…³ï¼Œä¸ç”¨çš„ entry ä¼šç”Ÿæˆä¸ç”¨çš„ chunkhash å€¼

   > å½“æˆ‘ä»¬å†™çš„ module æºæ–‡ä»¶ä¼ åˆ° webpack è¿›è¡Œæ‰“åŒ…æ—¶ï¼Œwebpack ä¼šæ ¹æ®æ–‡ä»¶å¼•ç”¨å…³ç³»ç”Ÿæˆ chunk æ–‡ä»¶(å­˜åœ¨å†…å­˜ä¸­)ï¼Œwebpack ä¼šå¯¹è¿™ä¸ª chunk æ–‡ä»¶è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬æ ¹æ® entry è¿˜æœ‰æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¥åˆ¤æ–­æ¨¡å—æ˜¯å¦å¤„äºåŒä¸€ä¸ª chunk

3. contenthashï¼šæ ¹æ®æ–‡ä»¶å†…å®¹æ¥å®šä¹‰ hashï¼Œæ–‡ä»¶å†…å®¹ä¸å˜ï¼Œcontenthash ä¸å˜

   > å®ƒçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ï¼Œè®© css æ–‡ä»¶ä¸å— js æ–‡ä»¶çš„å½±å“ã€‚æ¯”å¦‚ foo.css è¢« foo.js å¼•ç”¨äº†ï¼Œæ‰€ä»¥å®ƒä»¬å…±ç”¨ç›¸åŒçš„ chunkhash å€¼ã€‚ä½†è¿™æ ·å­æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœ foo.js ä¿®æ”¹äº†ä»£ç ï¼Œcss æ–‡ä»¶å°±ç®—å†…å®¹æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œç”±äºæ˜¯è¯¥æ¨¡å—çš„ hash å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ css æ–‡ä»¶çš„ hash ä¹Ÿä¼šéšä¹‹æ”¹å˜

### æ–‡ä»¶æŒ‡çº¹ç­–ç•¥

- jsã€css æ–‡ä»¶çš„æŒ‡çº¹ç­–ç•¥

1. js
   å¦‚æœé‡‡ç”¨ contenthash æ ¹æ® JS æ–‡ä»¶å†…å®¹æ¥ç”Ÿæˆ hash,ä½†æ˜¯ä¸€æ—¦æ ·å¼ä¿®æ”¹äº†ï¼Œcss æ–‡ä»¶åä¼šå˜åŒ–ï¼Œæ­¤æ—¶ JS æ–‡ä»¶åº”è¯¥ä¹Ÿè¦å˜åŒ–ï¼Œé‡æ–°å¼•å…¥æ­£ç¡® âœ… çš„æ–‡ä»¶æ‰å¯¹
2. css
   å½“ä½¿ç”¨ mini-css-extract-plugin æ’ä»¶æŠ½ç¦» css æ–‡ä»¶æ—¶å€™ï¼Œè¯¥æ’ä»¶å¯ä»¥è·å–åˆ° webapck ä¸­ hash ä»¥åŠå…¶è¯¥ chunk ä¸‹çš„ hashï¼Œå½“ç„¶æ”¹æ’ä»¶è¿˜å¯ä»¥è‡ªå·±æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆ hash ä¹Ÿå°±æ˜¯ contenthash
3. å›¾ç‰‡
   å½“æˆ‘ä»¬ä½¿ç”¨ file-loader å¤„ç†å›¾ç‰‡ç­‰èµ„æºæ—¶å€™ï¼Œå…¶é€‰é¡¹ contenthash ä»¥åŠ hash é€‰é¡¹æ˜¯è‡ªå·±å†…éƒ¨ç”Ÿæˆçš„ï¼Œâ—ï¸ ä¸é‡‡ç”¨ webpack ä¸­çš„ hash

## æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½åˆ†æ

#### ä½“ç§¯åˆ†æ

1. åˆçº§åˆ†æ é€šè¿‡å®˜æ–¹æä¾›çš„ stat.json æ–‡ä»¶å¸®åŠ©æˆ‘ä»¬åˆ†ææ‰“åŒ…ç»“æœï¼Œstat.json æ–‡ä»¶ç”Ÿæˆå‘½ä»¤ `webpack --profile --json > stats.json`
2. ç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…· webpack-bundle-analyzer æ˜¯æ‰“åŒ…åˆ†æç¥å™¨ webpack-bundle-analyzer å…¶åº•å±‚ä¹Ÿæ˜¯ä¾èµ– stat.json æ–‡ä»¶çš„ï¼Œé€šè¿‡å¯¹ stat.json çš„åˆ†æï¼Œå¾—å‡ºæœ€åçš„åˆ†æé¡µé¢

#### é€Ÿåº¦åˆ†æ

speed-measure-webpack-plugin è¿™ä¸ªæ’ä»¶å¸®åŠ©æˆ‘ä»¬åˆ†ææ•´ä¸ªæ‰“åŒ…çš„æ€»è€—æ—¶ï¼Œä»¥åŠæ¯ä¸€ä¸ª loader å’Œæ¯ä¸€ä¸ª plugins æ„å»ºæ‰€è€—è´¹çš„æ—¶é—´ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½åˆ°å¯ä»¥ä¼˜åŒ– Webpack çš„é…ç½®
